# Unit та Integration тести для VoiceMood Shop System

## Опис створених тестів

Для системи інтернет-магазину було створено повний комплект тестів, що покривають всі основні компоненти:

### 1. Entity тести
- **SmartphoneTest** - тестування ентіті Smartphone та наслідування від MobilePhone і Product
- **LaptopTest** - тестування ентіті Laptop та наслідування від Product  
- **RegularCustomerTest** - тестування розрахунку знижок для постійних покупців

### 2. Service тести
- **PurchaseServiceTest** - повне тестування логіки покупок з використанням Mockito:
  - Успішне проведення покупки
  - Обробка недостатніх коштів
  - Перевірка залишків товару
  - Розрахунок знижок
  - Статистика покупок
- **AuthServiceTest** - тестування автентифікації та авторизації:
  - Реєстрація користувачів та адміністраторів
  - Авторизація з правильними/неправильними даними
  - Валідація JWT токенів

### 3. Controller тести
- **ProductControllerTest** - тестування REST API з використанням MockMvc:
  - Отримання всіх товарів
  - Пошук товарів за ID, фірмою, назвою
  - Обробка помилок та виключень
  - Перевірка безпеки API

### 4. Repository тести
- **ProductRepositoryTest** - інтеграційні тести JPA репозиторіїв з H2:
  - CRUD операції
  - Пошукові запити
  - Тестування JPA наслідування
  - Перевірка кастомних методів

### 5. Integration тести
- **ApplicationIntegrationTest** - повні інтеграційні тести:
  - Запуск Spring контексту
  - Взаємодія між компонентами
  - End-to-end тестування покупок
  - Реальна робота з базою даних

## Використані технології тестування

- **JUnit 5** - основний фреймворк для тестування
- **Mockito** - для мокування залежностей в unit тестах
- **Spring Boot Test** - для інтеграційних тестів
- **MockMvc** - для тестування REST контролерів
- **H2 Database** - in-memory база для тестів
- **@DataJpaTest** - для тестування JPA репозиторіїв
- **Spring Security Test** - для тестування безпеки

## Як запустити тести

### Запуск всіх тестів (потрібен Maven):
```bash
mvn test
```

### Запуск конкретного тестового класу:
```bash
mvn test -Dtest=PurchaseServiceTest
```

### Запуск з детальним виводом:
```bash
mvn test -Dtest=* -Dmaven.test.failure.ignore=true
```

### В IDE (IntelliJ IDEA / Eclipse):
1. Правий клік на папці `src/test/java`
2. Вибрати "Run All Tests"
3. Або запускати окремі тестові класи

## Конфігурація тестів

- **application-test.properties** - конфігурація для тестового середовища
- Використовується H2 in-memory база даних
- JWT токени з тестовими ключами
- Відключені непотрібні логи

## Покриття тестами

Тести покривають:
- ✅ Entity класи та їх логіку
- ✅ Business логіку в сервісах
- ✅ REST API endpoints
- ✅ JPA репозиторії та запити  
- ✅ Автентифікацію та авторизацію
- ✅ Систему знижок
- ✅ Обробку помилок
- ✅ Валідацію даних

## Структура тестів

```
src/test/java/
├── org/example/
│   ├── entity/
│   │   ├── SmartphoneTest.java
│   │   ├── LaptopTest.java
│   │   └── RegularCustomerTest.java
│   ├── service/
│   │   ├── PurchaseServiceTest.java
│   │   └── AuthServiceTest.java
│   ├── controller/
│   │   └── ProductControllerTest.java
│   ├── repository/
│   │   └── ProductRepositoryTest.java
│   └── ApplicationIntegrationTest.java
└── resources/
    └── application-test.properties
```

## Приклади тестових сценаріїв

### Тестування покупки:
1. Користувач з достатніми коштами
2. Користувач з недостатніми коштами  
3. Товар відсутній на складі
4. Розрахунок знижки для постійного покупця
5. Оновлення балансу та кількості товару

### Тестування автентифікації:
1. Реєстрація нового користувача
2. Реєстрація адміністратора з ключем
3. Вхід з правильними даними
4. Вхід з неправильними даними
5. Валідація JWT токенів 